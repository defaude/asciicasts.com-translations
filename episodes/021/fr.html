<p>dnas l'épisode précédent, nous vous avons montré comment montrer ou cacher nos liens d'administration en fonction du statut de l'utilisateur courant. Pour faire ça, on a écrit une méthode booléenne appelée <code>admin?</code> dans <code>ApplicationController</code>. Si <code>admin?</code> retourne <code>true</code> alors les liens sont visibles, sinon ils sont cachés. Nous avons laissé la méthode retourner  <code>false</code>; ce dont on a besoin c'est de finir d'écrire la méthode et fournir aux administrateurs de se connecter au site.</p>

<h3>Il y a plus d'une façon de le faire</h3>
<p>Il y a beaucoup de façons différentes d'implémenter un système de connexion. Nous pourrions implémenter un enregistrement complet d'utilisateur avec un modèle <code>User</code>, une page d'inscription et ainsi de suite. Si nous étions partis pour adopter cette approche, il existe un excellent plugin appelé <code>restful_authentication</code>, qui est une version améliorée de <code>acts_as_authenticated</code>, disponible au téléchargement.<sup><a href="#fn1">1</a></sup> Une fois installé, le modèle <code>User</code> et un contrôleur <code>Sessions</code> peuvent être généré comme ceci :</p>
<pre class="terminal">
$script/plugin install git://github.com/technoweenie/restful-authentication.git restful_authentication
$script/generate authenticated User sessions
$rake db:migrate
</pre>
<p>Nous n'allons pas utiliser Restful Authentication ici. Le plugin <code>restful_authentication</code> sera abordé plus en détail dans l'épisode 67.</p>

<p>Notre site est si simple qu'un système complet n'est pas nécessaire. Nous avons seulement besoin de gérer les épisodes du site, donc nous allons adopter une approche plus directe qui ne nécessite pas de modèle <code>User</code> ou de plugins. Si nous voulions prendre une approche vraiment simple nous pourrions restreindre l'accès grâce à l'adresse IP et écrire notre méthode <code>admin?</code> comme ceci.</p>
<pre class="ruby">
def admin
  request.remote_ip == &quot;127.0.0.1&quot;
end
</pre>
<p>Ceci est plus limité puisque ça implique que votre connexion internet a une adresse IP fixe et que vous voudrez toujours administrer votre site depuis le même endroit. À la place de ceci, nous alloons construire une page de connexion simple qui ne requiert qu'un mot de passe. Si le mot de passe saisi est correct alors l'utilisateur verra les liens d'administration.</p>

<img src="/system/photos/18/original/E021I01.png" width="742" height="254" />
<p class="title">Notre page de connexion basique.</p>
<p>Pour faire ça, nous allons générer un contrôleur <code>Sessions</code>. Le code du contrôleur est le suivant :</p>
<pre class="ruby">
class SessionsController &lt; ApplicationController
  def new
  end

  def create
    session[:password] = params[:password]
    flash[:notice] = &rsquo;Successfully logged in&rsquo;
    redirect_to home_path
  end
  
  def destroy
    reset_session
    flash[:notice] = &rsquo;Successfully logged out&rsquo;
    redirect_to login_path
  end
end
</pre>
<p>Il y a aussi une nouvelle vue dans le dossier <code>/views/sessions</code>.</p>
<pre class="ruby">
&lt;% form_tag sessions_path do %&gt;
  Password: &lt;%= password_field_tag :password %&gt;
  &lt;%= submit_tag &quot;Login&quot; %&gt;
&lt;% end %&gt;
</pre>
<p>Le formulaire est soumis à l'action <code>create</code> qui enregistre le mot de passe dans la session puis redirige vers la page d'accueil. Dans notre méthode <code>admin?</code> nous contrôlons que le mot de passe en session est correct et on retourne <code>true</code> le cas échéant.</p>
<pre class="ruby">
def admin?
  session[:password] == &quot;secret&quot;
end
</pre>

<h3>The end.</h3>
<p>Notre page de connexion est maintenant complète. Bien que pas particulièrement sophistiquée comparée à un système de gestion d'utilisateur comme celui fourni par Restful Authentication, c'est un moyen suffisant pour un site simple.</p>
<p>Finalement, au cas où vous vous demanderiez comment on a donné l'url <code>/login</code> à notre page de connexion, ça se passe dans <code>routes.rb</code></p>
<pre class="ruby">
  map.connect &rsquo;login&rsquo;, :controller =&gt; &rsquo;sessions&rsquo;, :action =&gt; &rsquo;create&rsquo;
  map.connect &rsquo;logout&rsquo;, :controller =&gt; &rsquo;sessions&rsquo;, :action =&gt; &rsquo;destroy&rsquo;
</pre>
<h3>Notes</h3>
<ol class="footnotes">
  <li id="fn1"><a href="http://github.com/technoweenie/restful-authentication/tree/master">http://github.com/technoweenie/restful-authentication/tree/master</a></li>
</ol>